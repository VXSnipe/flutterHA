# GitHub Actions Workflow for Flutter CI/CD
# Requirement A&A5: Continuous Integration and Delivery Pipeline
# This workflow automatically builds and tests the Flutter application on every push to main branch

name: Flutter CI/CD Pipeline

# Trigger: Run on every push to main branch and on pull requests
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # Job 1: Build and Test Flutter Application
  build:
    name: Build Flutter App
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Checkout the repository code
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      # Step 2: Set up Java (required for Android builds)
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          
      # Step 3: Set up Flutter SDK
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.x'
          channel: 'stable'
          
      # Step 4: Install Flutter dependencies
      - name: Install Dependencies
        run: flutter pub get
        
      # Step 5: Analyze code for issues
      - name: Analyze Code
        run: flutter analyze
        
      # Step 6: Run tests (if any)
      - name: Run Tests
        run: flutter test
        continue-on-error: true  # Continue even if no tests exist
        
      # Step 7: Build Android APK
      - name: Build Android APK
        run: flutter build apk --debug
        
      # Step 8: Upload APK as artifact
      - name: Upload APK Artifact
        uses: actions/upload-artifact@v4
        with:
          name: flutter-debug-apk
          path: build/app/outputs/flutter-apk/app-debug.apk
          retention-days: 7
          
      # Step 9: Build success notification
      - name: Build Success
        if: success()
        run: echo "✅ Flutter build completed successfully!"
        
      # Step 10: Build failure notification
      - name: Build Failed
        if: failure()
        run: echo "❌ Flutter build failed. Check logs above."

  # Job 2: Check Code Quality (runs in parallel with build)
  quality-check:
    name: Code Quality Check
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.x'
          channel: 'stable'
          
      - name: Install Dependencies
        run: flutter pub get
        
      - name: Check Formatting
        run: dart format --set-exit-if-changed lib/
        continue-on-error: true
        
      - name: Code Quality Report
        run: echo "✅ Code quality checks completed"
